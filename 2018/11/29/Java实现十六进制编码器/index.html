<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Java实现十六进制编码器 · ChengUU</title><meta name="description" content="Java实现十六进制编码器 - ChengUU"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="https://github.com/ChengUU/atom.xml" title="ChengUU"></head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">ChengUU</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>INDEX</p></a><a href="/archives" target="_self" class="li component-nav-item"><p>ARCHIVES</p></a><a href="/categories" target="_self" class="li component-nav-item"><p>CATEGORIES</p></a><a href="/tags" target="_self" class="li component-nav-item"><p>TAGS</p></a><ul class="shortcut-icons"><a href="https://github.com/ChengUU" target="_blank"><img src="/images/github.svg" class="icon"></a><a href="/atom.xml" target="_blank"><img src="/images/rss.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">Java实现十六进制编码器</h1><div class="post-info">2018年11月29日</div><div class="post-content"><h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p></p><p>以前也处理过将数字转换为16进制的问题，虽然现在已不记得当时的处理流程了，唯一留下的印象便是，复杂、不满意、可扩展性差、不够灵活……<br>由于项目需要打算自己实现CSPRNG（Cryptographically Secure Pseudo-Random Number Generator, 伪随机数产生器）。查阅相关资料后发现Java提供了相关的类(SecureRandom类)，并且非常好用。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SecureRandom secureRandom=new SecureRandom();</span><br><span class="line">byte[] bytes=new byte[32];</span><br><span class="line">secureRandom.nextBytes(bytes);</span><br></pre></td></tr></table></figure></p>
<p></p><p>但是生成的随机数结果是一个字节数组，这用起来不是很方便，于是就想着将其转换为16进制字符串。正如大家所知道的那样，Java写的很多工具库都是开源的，查阅相关资料后找到了一种较为简单且有效的实现(<strong><em><a href="https://github.com/bcgit/bc-java.git">开源工具库</a></em></strong>),该实现共涉及3个类: Strings-String类对应的工具类；HexEncoder-提供16进制编码具体实现，包括编码和解码；Hex通过持有HexEncoder类实例对象提供HexEncoder相关功能（—适配器模式的两种实现—）: 对字节数组进行编码，对十六进制字符串进行解码。</p>
<h2 id="编码实现"><a href="#编码实现" class="headerlink" title="编码实现"></a>编码实现</h2><p>字节与16进制数之间的对应关系：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 byte = 8 bits</span><br><span class="line">4 bits = 一位16进制数</span><br></pre></td></tr></table></figure></p>
<ol>
<li>16进制编码-字节数组转16进制<br>根据上述对应关系，可以对字节数组依次进行处理，具体的处理方法： 通过移位运算依次处理该字节的左边四位和右边四位并查找编码映射表取出相应的16进制字符，最后将其放入字节数组输出流。<br><strong>编码映射表 EncodingTable</strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">protected final byte[] encodingTable = new byte[]&#123;//digital number map to character</span><br><span class="line">    (byte) &apos;0&apos;, (byte) &apos;1&apos;, (byte) &apos;2&apos;, (byte) &apos;3&apos;, (byte) &apos;4&apos;, (byte) &apos;5&apos;, (byte) &apos;6&apos;, (byte) &apos;7&apos;,</span><br><span class="line">    (byte) &apos;8&apos;, (byte) &apos;9&apos;, (byte) &apos;a&apos;, (byte) &apos;b&apos;, (byte) &apos;c&apos;, (byte) &apos;d&apos;, (byte) &apos;e&apos;, (byte) &apos;f&apos;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>使用编码映射表可以提高编码速度，从而使进制转的效率得到较大的提升。字节数组转16进制数组的核心实现:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * encoding byte element to hexadecimal via shift operation.</span><br><span class="line"> *</span><br><span class="line"> * @param data   byte array</span><br><span class="line"> * @param offset the start position</span><br><span class="line"> * @param length the length of data to be processed.</span><br><span class="line"> * @param os     the result stream.</span><br><span class="line"> * @return the length of result.</span><br><span class="line"> * @throws IOException</span><br><span class="line"> */</span><br><span class="line">public int encode(byte[] data, int offset, int length, OutputStream os) throws IOException &#123;</span><br><span class="line">for (int i = offset; i &lt; offset + length; i++) &#123;</span><br><span class="line">    int val = data[i] &amp; 0xff;</span><br><span class="line">    // &gt;&gt;&gt;: unsigned right bit shift</span><br><span class="line">    os.write(encodingTable[val &gt;&gt;&gt; 4]);</span><br><span class="line">    os.write(encodingTable[val &amp; 0x0f]);</span><br><span class="line">&#125;</span><br><span class="line">// Each 4 bits corresponds to a hexadecimal number and one byte is 8 bits,</span><br><span class="line">// so the length of conversion result is 2 times original data length.</span><br><span class="line">return length * 2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol start="2">
<li>16进制字符串转字节数组<br>16进制字符串亦可以是字节数组，字符串中每一个字符占1字节，字节数组中每一个元素也占一个字节，它们在更小度量上是一样的——8 bits，原则上每一位元素均为16进制字符，也就是说每一个元素或字符仅有其右四位为有效位(左边四位默认值为全零)。在将16进制字符串转换为字节数组的时利用位运算可以将相邻的两位16进制数存至一个字节中： 将前一个字符或元素向左移4位后再与另一个字符或元素进行或运算，这样就将其存至1个字节中。16进制字符串转字节数组核心实现：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * decoding hexadecimal string to digital number.</span><br><span class="line"> * @param data hexadecimal string.</span><br><span class="line"> * @param os the result stream.</span><br><span class="line"> * @return the length of result stream.</span><br><span class="line"> * @throws IOException</span><br><span class="line"> */</span><br><span class="line">public int decode(String data,OutputStream os)throws IOException&#123;</span><br><span class="line">    byte b1,b2;</span><br><span class="line">    int length=0;</span><br><span class="line">    int offset=0;</span><br><span class="line">    int end=data.length();</span><br><span class="line">    while(end&gt;offset)&#123;</span><br><span class="line">        char ch=data.charAt(end-1);</span><br><span class="line">        if(!ignore(ch)) break;</span><br><span class="line">        end--;</span><br><span class="line">    &#125;</span><br><span class="line">    int i=offset;</span><br><span class="line">    while(i&lt;end)&#123;</span><br><span class="line">        char ch=data.charAt(i);</span><br><span class="line">        while(i&lt;end&amp;&amp;ignore(ch)) &#123;</span><br><span class="line">            ch=data.charAt(++i);</span><br><span class="line">        &#125;</span><br><span class="line">        b1=decodingTable[data.charAt(i++)];</span><br><span class="line">        ch=data.charAt(i);</span><br><span class="line">        while(i&lt;end&amp;&amp;ignore(ch))&#123;</span><br><span class="line">            ch=data.charAt(++i);</span><br><span class="line">        &#125;</span><br><span class="line">        b2=decodingTable[data.charAt(i++)];</span><br><span class="line"></span><br><span class="line">        if((b1|b2)&lt;0)&#123;</span><br><span class="line">            throw new IOException(&quot;invalid character encounter in Hex data&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        os.write((b1&lt;&lt;4)|b2);</span><br><span class="line">        length++;</span><br><span class="line">    &#125;</span><br><span class="line">    return length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><em>需要注意的是</em>该十六进制字符串应该为长度是偶数的字符串，否则在转换过程中将会出现不可处理的错误，由于待转换的字符串由使用者传入，所以在并未进行额外的处理。</p>
<ol start="3">
<li><p>Hex工具类<br>该工具类持有一个类常量对象encoder，并提供类静态方法使用HexEncoder编解码功能，通过该来对HexEncoder类进行了适配，该类主要提供的方法包括： toHexString(byte[] data),decode(String data).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * encoding byte array.</span><br><span class="line"> * @param data byte array to be encoded.</span><br><span class="line"> * @return Hexadecimal String.</span><br><span class="line"> */</span><br><span class="line">public static String toHexString(byte[] data)&#123;</span><br><span class="line">    return toHexString(data,0,data.length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * encodeing byte array.</span><br><span class="line"> * @param data byte array to be encoded.</span><br><span class="line"> * @param offset the start of encoding element.</span><br><span class="line"> * @param length the length of element to be encoded.</span><br><span class="line"> * @return Hexadecimal String.</span><br><span class="line"> */</span><br><span class="line">public static String toHexString(byte[] data,int offset,int  length)&#123;</span><br><span class="line">    byte[] encoded=encode(data,offset,length);</span><br><span class="line">    return Strings.fromByteArray(encoded);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * encode byte array to  be hexadecimal character byte array.</span><br><span class="line"> * @param data the byte array to be encoded.</span><br><span class="line"> * @param offset the start of encoding position.</span><br><span class="line"> * @param length the length of element to be encoded.</span><br><span class="line"> * @return hexadecimal character byte array.</span><br><span class="line"> */</span><br><span class="line">public static byte[] encode(byte[] data,int offset,int length)&#123;</span><br><span class="line">    ByteArrayOutputStream baos=new ByteArrayOutputStream();</span><br><span class="line">    try&#123;</span><br><span class="line">        encoder.encode(data,offset,length,baos);</span><br><span class="line">    &#125;catch(IOException e)&#123;</span><br><span class="line">        throw new EncoderException(&quot;exception encoding Hex string: &quot; + e.getMessage(), e);</span><br><span class="line">    &#125;</span><br><span class="line">    return baos.toByteArray();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * decoding hex string, whitespace will be ignored.</span><br><span class="line"> * @param data Hex String.</span><br><span class="line"> * @return decoding result.</span><br><span class="line"> * @throws IOException</span><br><span class="line"> */</span><br><span class="line">public static byte[] decode(String data)throws IOException&#123;</span><br><span class="line">    ByteArrayOutputStream baos=new ByteArrayOutputStream();</span><br><span class="line">    decode(data,baos);</span><br><span class="line">    return baos.toByteArray();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * decoding Hex String.</span><br><span class="line"> * @param data Hex String</span><br><span class="line"> * @param os OutputStream Object.</span><br><span class="line"> * @return the length of decoding producing byte.</span><br><span class="line"> * @throws IOException</span><br><span class="line"> */</span><br><span class="line">public static int decode(String data,OutputStream os)throws IOException&#123;</span><br><span class="line">    return encoder.decode(data,os);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Strings类实现<br>Strings类为String类对应的工具类，该类在此提供了将字节数组转换成字符数组功能和将字节数组转换为字符串功能。<br>具体实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * converting byte array to string.</span><br><span class="line"> *</span><br><span class="line"> * @param encoded the byte array to be processed.</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">public static String fromByteArray(byte[] encoded) &#123;</span><br><span class="line">    return new String(asCharArray(encoded));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * converting byte array to char array.</span><br><span class="line"> *</span><br><span class="line"> * @param encoded the byte array to be processed.</span><br><span class="line"> * @return char array.</span><br><span class="line"> */</span><br><span class="line">private static char[] asCharArray(byte[] encoded) &#123;</span><br><span class="line">    char[] chars = new char[encoded.length];</span><br><span class="line">    for (int i = 0; i &lt; chars.length; i++) &#123;</span><br><span class="line">        chars[i] = (char) (encoded[i] &amp; 0xff);</span><br><span class="line">    &#125;</span><br><span class="line">    return chars;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试<br>主要针对Java内置加密安全的伪随机数生成结果进行编解码，对常见字符串进行编解码，对常见数字进行编解码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">package test;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import util.encoders.Hex;</span><br><span class="line"></span><br><span class="line">import java.io.ByteArrayOutputStream;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.security.SecureRandom;</span><br><span class="line">import java.util.Arrays;</span><br><span class="line"></span><br><span class="line">public class CsprngTest &#123;</span><br><span class="line">    public static void main(String[] args)throws IOException &#123;</span><br><span class="line">        SecureRandom secureRandom=new SecureRandom();</span><br><span class="line">        byte[] bytes=new byte[32];</span><br><span class="line">        secureRandom.nextBytes(bytes);</span><br><span class="line">        String str= Hex.toHexString(bytes);</span><br><span class="line">        System.out.println(str);</span><br><span class="line">        byte[] decodeBytes=Hex.decode(str);</span><br><span class="line">        boolean flag=Arrays.equals(bytes,decodeBytes);</span><br><span class="line">        System.out.println(&quot;equals: &quot;+flag);</span><br><span class="line"></span><br><span class="line">        System.out.println(Hex.toHexString(&quot;0123456789abcdef&quot;.getBytes()));                    //测试将字符串转化为16进制</span><br><span class="line">        System.out.println(new String(Hex.decode(&quot;30313233343536373839616263646566&quot;)));   //反向测试将16进制转化为字符串</span><br><span class="line"></span><br><span class="line">        int integer=1000;</span><br><span class="line">        ByteArrayOutputStream baos=new ByteArrayOutputStream();</span><br><span class="line">        baos.write(integer);</span><br><span class="line">        bytes=baos.toByteArray();</span><br><span class="line">        System.out.println(&quot;bytes lngth: &quot;+bytes.length);</span><br><span class="line">        str=Hex.toHexString(bytes);</span><br><span class="line">        System.out.println(str);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="程序执行结果"><a href="#程序执行结果" class="headerlink" title="程序执行结果"></a>程序执行结果</h3><p><img src="/images/2018-11-29 22:14:29屏幕截图.png" alt="测试结果"></p>
</div></article></div><div id="disqus_thread"></div></div><script>var disqus_shortname = '[object Object]';
var disqus_identifier = '2018/11/29/Java实现十六进制编码器/';
var disqus_title = 'Java实现十六进制编码器';
var disqus_url = 'https://github.com/ChengUU/2018/11/29/Java实现十六进制编码器/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//[object Object].disqus.com/count.js" async></script></main><footer class="footer-container"><div class="paginator"><a href="/2018/11/23/hello-world/" class="next">下一篇</a></div><div class="copyright"><p>© 2017 - 2018 <a href="https://github.com/ChengUU">ChengUU</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer><script async src="https://tajs.qq.com/stats?sId=66115146" charset="UTF-8"></script></body></html>